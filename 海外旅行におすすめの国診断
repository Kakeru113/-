<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ·å¤–æ—…è¡Œ ãŠã™ã™ã‚ã®å›½ è¨ºæ–­</title>
    <!-- Tailwind CSS CDNã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .quiz-card {
            background-color: white;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 0 10px -5px rgba(0, 0, 0, 0.04);
        }
        .option-button {
            transition: all 0.2s;
            cursor: pointer;
        }
        .option-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .selected-option {
            border-color: #3b82f6; /* blue-500 */
            background-color: #eff6ff; /* blue-50 */
            transform: scale(1.02);
        }
        .progress-bar {
            height: 8px;
            background-color: #bfdbfe; /* blue-200 */
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background-color: #3b82f6; /* blue-500 */
            transition: width 0.4s ease-in-out;
        }
        .rank-1 {
            border-color: #f59e0b; /* amber-500 */
            background-color: #fffbeb; /* amber-50 */
        }
        .rank-2 {
            border-color: #9ca3af; /* gray-400 */
            background-color: #f3f4f6; /* gray-100 */
        }
    </style>
</head>
<body>

    <div id="app" class="min-h-screen flex items-center justify-center p-4 sm:p-6 lg:p-8">
        <div class="quiz-card w-full max-w-lg mx-auto rounded-xl p-6 sm:p-10">

            <header class="mb-8 text-center">
                <h1 class="text-3xl font-extrabold text-gray-900 mb-2">æµ·å¤–æ—…è¡Œ ãŠã™ã™ã‚ã®å›½ è¨ºæ–­ (ã“ã©ã‚‚å‘ã‘)</h1>
                <p class="text-gray-500">å…¨éƒ¨ã§6ã¤ã®è³ªå•ã«ç­”ãˆã¦ã€ã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®æ—…è¡Œå…ˆã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†ï¼</p>
            </header>

            <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
            <div class="mb-8">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-bar-fill" style="width: 0%;"></div>
                </div>
                <p id="progress-text" class="text-sm text-gray-500 mt-2 text-right"></p>
            </div>

            <!-- ã‚¯ã‚¤ã‚ºã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <div id="quiz-container">
                <!-- è³ªå•/çµæœãŒã“ã“ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ -->
            </div>

            <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div id="navigation-buttons" class="mt-8 flex justify-between">
                <button id="prev-button" onclick="app.prevStep()" class="px-6 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg shadow hover:bg-gray-300 transition duration-150 ease-in-out disabled:opacity-50" disabled>
                    &larr; æˆ»ã‚‹
                </button>
                <button id="next-button" onclick="app.nextStep()" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-lg shadow-blue-500/50 hover:bg-blue-700 transition duration-150 ease-in-out disabled:opacity-50" disabled>
                    æ¬¡ã¸ &rarr;
                </button>
            </div>

        </div>
    </div>

    <script>
        const app = {
            // --- è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ ---
            questions: [
                {
                    id: 1,
                    text: "æ—…è¡Œå…ˆã§æ¥½ã—ã¿ãŸã„ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
                    options: [
                        { text: "ã„ã‚ã„ã‚ãªå›½ã®ãŠã„ã—ã„é£Ÿã¹ç‰©ã‚„Bç´šã‚°ãƒ«ãƒ¡ã‚’ãŸãã•ã‚“é£Ÿã¹ã‚‹ï¼", score: { budget: 1, near: 1, history: 1 } },
                        { text: "éŠåœ’åœ°ã‚„å‹•ç‰©åœ’ãªã©ã€æ¥½ã—ã„ä½“é¨“ã‚„ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’é‡è¦–ï¼", score: { budget: 2, nature: 1, city: 1 } },
                        { text: "ã¡ã‚‡ã£ã¨é«˜ä¾¡ãªãŠåœŸç”£ã‚„ã€ãã‚Œã„ãªãƒ›ãƒ†ãƒ«ã§ã®ã‚“ã³ã‚Šéã”ã™ï¼", score: { budget: 3, luxury: 1, history: 1, nature: 1, city: 1 } },
                        { text: "ãã‚Œã„ãªæµ·ã‚„ãƒ—ãƒ¼ãƒ«ã§æ³³ã„ã ã‚Šã€ã®ã‚“ã³ã‚Šæ—¥å…‰æµ´ã—ãŸã‚Šã™ã‚‹ï¼", score: { nature: 2, luxury: 1, safety: 1, near: 1 } }, 
                    ]
                },
                {
                    id: 2,
                    text: "ã©ã®ãã‚‰ã„ã®ãŠä¼‘ã¿ã§è¡Œãäºˆå®šã§ã™ã‹ï¼Ÿ",
                    options: [
                        { text: "çŸ­ã„é€£ä¼‘ (3ã€œ5æ—¥ãã‚‰ã„ã§ã€ã‚ã¾ã‚Šé ããªã„å ´æ‰€ãŒã„ã„)", score: { duration: 1, near: 1, city: 1 } },
                        { text: "å°‘ã—é•·ã‚ã®ãŠä¼‘ã¿ (6ã€œ9æ—¥ãã‚‰ã„ã§ã€è‰²ã€…ãªå ´æ‰€ã‚’å›ã‚ŠãŸã„)", score: { duration: 2, city: 1, nature: 1, history: 1 } },
                        { text: "é•·ã„å¤ä¼‘ã¿ã‚„å†¬ä¼‘ã¿ (10æ—¥ä»¥ä¸Šã‹ã‘ã¦ã€é ã„å›½ã«ã‚‚è¡Œã£ã¦ã¿ãŸã„)", score: { duration: 3, far: 1, history: 1, nature: 1 } },
                        { text: "ç§»å‹•æ™‚é–“ã¯æ°—ã«ã—ãªã„ã®ã§ã€ã¨ã¦ã‚‚é ã„å›½ã«ãœã²è¡Œã£ã¦ã¿ãŸã„ï¼", score: { duration: 3, far: 3, history: 1, nature: 1 } }, 
                    ]
                },
                {
                    id: 3,
                    text: "æœ€ã‚‚èˆˆå‘³ã®ã‚ã‚‹ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã¯ä½•ã§ã™ã‹ï¼Ÿ",
                    options: [
                        { text: "éƒ½ä¼šã®è¦³å…‰ã€ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã€ã‚°ãƒ«ãƒ¡", score: { city: 3, near: 1 } },
                        { text: "å¤§è‡ªç„¶ã€çµ¶æ™¯ã€ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£", score: { nature: 3, duration: 1 } },
                        { text: "æ­´å²çš„å»ºé€ ç‰©ã€ç¾è¡“é¤¨ã€ç•°æ–‡åŒ–ä½“é¨“", score: { history: 3, far: 1 } },
                        { text: "ã‚¹ãƒãƒ¼ãƒ„è¦³æˆ¦ã‚„ã€ãã®å›½ã§æµè¡Œã£ã¦ã„ã‚‹ã‚«ãƒ«ãƒãƒ£ãƒ¼ï¼ˆéŸ³æ¥½ãªã©ï¼‰ã«è§¦ã‚ŒãŸã„ï¼", score: { city: 2, future: 1, luxury: 1 } }, 
                    ]
                },
                {
                    id: 4,
                    text: "æ—…å…ˆã§é‡è¦–ã™ã‚‹è¦ç´ ã¯ä½•ã§ã™ã‹ï¼Ÿ",
                    options: [
                        // è³ªå•æ–‡ã‚’ã€Œæ²»å®‰ã€ã‹ã‚‰ã€Œå®‰å…¨ã€ã¨å…·ä½“çš„ãªå®‰å¿ƒæ„Ÿã«ä¿®æ­£
                        { text: "å®‰å…¨ãŒã„ã¡ã°ã‚“å¤§äº‹ï¼ã“ã‚ã„ã“ã¨ãŒèµ·ããªã„ã‹å¿ƒé…ã›ãšã€å®‰å¿ƒã—ã¦éã”ã—ãŸã„ã€‚", score: { safety: 3, duration: 1, city: 1 } },
                        { text: "æ—¥æœ¬ã‹ã‚‰ã®ç§»å‹•æ™‚é–“ï¼ˆãƒ•ãƒ©ã‚¤ãƒˆæ™‚é–“ï¼‰ãŒçŸ­ã„ã“ã¨", score: { near: 3, city: 1 } },
                        { text: "å†™çœŸæ˜ ãˆã™ã‚‹çµ¶æ™¯ã‚¹ãƒãƒƒãƒˆãŒå¤šã„ã“ã¨", score: { nature: 2, luxury: 1, history: 1 } }, 
                        { text: "è²·ã„ç‰©ã‚„é£Ÿäº‹ãªã©ã€ãŠé‡‘ãŒã‚ã¾ã‚Šã‹ã‹ã‚‰ãªã„ã“ã¨", score: { budget: 3, near: 1, history: 1 } }, 
                    ]
                },
                {
                    id: 5,
                    text: "ç¾åœ°ã§ã©ã‚“ãªé£Ÿäº‹ã‚’æ¥½ã—ã¿ãŸã„ã§ã™ã‹ï¼Ÿ",
                    options: [
                        { text: "å®‰ãã¦ç¾å‘³ã—ã„å±‹å°é£¯ã‚„Bç´šã‚°ãƒ«ãƒ¡", score: { budget: 1, near: 1, history: 1 } },
                        { text: "å¤šå›½ç±æ–™ç†ã‚„æ´—ç·´ã•ã‚ŒãŸãƒŸã‚·ãƒ¥ãƒ©ãƒ³ç´šã®æ–™ç†", score: { luxury: 2, city: 1, far: 1 } }, 
                        { text: "ãƒ­ãƒ¼ã‚«ãƒ«ãªé£Ÿæã‚’ä½¿ã£ãŸç´ æœ´ã§ãƒ˜ãƒ«ã‚·ãƒ¼ãªæ–™ç†", score: { nature: 1, safety: 1, duration: 1 } }, 
                        { text: "ä¸–ç•Œçš„ã«æœ‰åãªã‚¹ã‚¤ãƒ¼ãƒ„ã‚„ãƒ‡ã‚¶ãƒ¼ãƒˆã‚’å‘³ã‚ã„ãŸã„ï¼", score: { luxury: 1, city: 1, fantasy: 2 } }, 
                    ]
                },
                // æ–°ã—ã„è³ªå• (Q6): ãƒ†ãƒ¼ãƒã‚’è¿½åŠ 
                {
                    id: 6,
                    text: "ã‚ãªãŸã®èˆˆå‘³ãŒã‚ã‚‹æ—…ã®ãƒ†ãƒ¼ãƒã¯ä½•ã§ã™ã‹ï¼Ÿ",
                    options: [
                        { text: "ã‹ã‚ã„ã„å‹•ç‰©ãŸã¡ï¼ˆã‚³ã‚¢ãƒ©ã€ã‚«ãƒ³ã‚¬ãƒ«ãƒ¼ãªã©ï¼‰ã«ä¼šã„ãŸã„ï¼", score: { animal: 3, nature: 1 } },
                        { text: "ãŠåŸã‚„é­”æ³•ã®ä¸–ç•Œã€ç‰©èªã«å‡ºã¦ãã‚‹ã‚ˆã†ãªå ´æ‰€ã«è¡ŒããŸã„ï¼", score: { fantasy: 3, history: 1 } },
                        { text: "æœªæ¥çš„ãªå»ºç‰©ã‚„ã€å®‡å®™ãƒ»ç§‘å­¦æŠ€è¡“ã«é–¢ä¿‚ã™ã‚‹æ–½è¨­ãŒè¦‹ãŸã„ï¼", score: { future: 3, city: 1, luxury: 1 } },
                        { text: "ç ‚æ¼ ã‚„æ¥µåœ°ãªã©ã€æ—¥æœ¬ã§ã¯çµŒé¨“ã§ããªã„çã—ã„è‡ªç„¶ã‚„é¢¨æ™¯ã‚’è¦‹ãŸã„ï¼", score: { nature: 3, far: 2, history: 1 } }, 
                    ]
                }
            ],

            // --- çŠ¶æ…‹ç®¡ç† ---
            currentStep: 0, 
            answers: [],    
            totalSteps: 6, 
            
            // --- åˆæœŸåŒ–å‡¦ç† ---
            init() {
                this.totalSteps = this.questions.length;
                this.renderStep();
            },

            // --- UIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ---
            renderStep() {
                const container = document.getElementById('quiz-container');
                const navButtons = document.getElementById('navigation-buttons');
                const progressFill = document.getElementById('progress-fill');
                const progressText = document.getElementById('progress-text');
                const prevButton = document.getElementById('prev-button');
                const nextButton = document.getElementById('next-button');

                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°
                const percentage = (this.currentStep / this.totalSteps) * 100;
                progressFill.style.width = `${percentage}%`;
                progressText.textContent = `è³ªå• ${Math.min(this.currentStep + 1, this.totalSteps)} / ${this.totalSteps}`;

                // è³ªå•ã‚¹ãƒ†ãƒƒãƒ—
                if (this.currentStep < this.totalSteps) {
                    const question = this.questions[this.currentStep];
                    const currentAnswer = this.answers[this.currentStep];

                    // è³ªå•ã¨é¸æŠè‚¢ã®HTMLç”Ÿæˆ
                    container.innerHTML = `
                        <div class="question-title mb-6">
                            <h2 class="text-xl font-bold text-gray-800">${question.id}. ${question.text}</h2>
                        </div>
                        <div class="space-y-4">
                            ${question.options.map((option, index) => `
                                <div id="option-${index}"
                                     class="option-button p-4 border-2 border-gray-200 rounded-lg text-gray-700
                                            ${currentAnswer === index ? 'selected-option' : ''}"
                                     onclick="app.selectOption(${index})">
                                    ${option.text}
                                </div>
                            `).join('')}
                        </div>
                    `;

                    // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
                    prevButton.disabled = this.currentStep === 0;
                    if (this.currentStep === this.totalSteps - 1) {
                         nextButton.textContent = 'çµæœã‚’è¦‹ã‚‹ï¼';
                    } else {
                         nextButton.textContent = 'æ¬¡ã¸ &rarr;';
                    }
                    nextButton.disabled = currentAnswer === undefined;
                }
                // çµæœã‚¹ãƒ†ãƒƒãƒ—
                else {
                    container.innerHTML = this.renderResult();
                    navButtons.style.display = 'none'; // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
                }
            },

            // --- é¸æŠè‚¢ã®å‡¦ç† ---
            selectOption(index) {
                this.answers[this.currentStep] = index;
                this.renderStep(); // UIã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦é¸æŠçŠ¶æ…‹ã‚’åæ˜ ã•ã›ã‚‹
            },

            // --- ã‚¹ãƒ†ãƒƒãƒ—ç§»å‹• ---
            nextStep() {
                if (this.answers[this.currentStep] !== undefined) {
                    this.currentStep++;
                    this.renderStep();
                }
            },

            prevStep() {
                if (this.currentStep > 0) {
                    this.currentStep--;
                    this.renderStep();
                }
            },

            // --- çµæœè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ---
            calculateResult() {
                // ã‚¹ã‚³ã‚¢é …ç›®ã®å®šç¾©
                const totalScore = {
                    budget: 0, duration: 0, city: 0, nature: 0, history: 0, 
                    safety: 0, near: 0, luxury: 0, far: 0, animal: 0, 
                    fantasy: 0, future: 0
                };

                // ã‚¹ã‚³ã‚¢é›†è¨ˆ
                this.answers.forEach((optionIndex, questionIndex) => {
                    const question = this.questions[questionIndex];
                    if (question && question.options[optionIndex]) {
                        const option = question.options[optionIndex];
                        for (const key in option.score) {
                            totalScore[key] += option.score[key];
                        }
                    }
                });

                // ãƒ­ã‚¸ãƒƒã‚¯ã«åŸºã¥ã„ãŸæ¨å¥¨å›½ã®è¨­å®š (ç´„35ã‚«å›½ã‚’ã‚«ãƒãƒ¼)
                let recommendations = [];
                // é¸æŠè‚¢ãŒå¢—ãˆãŸãŒã€å¼·ã„å‚¾å‘ï¼ˆ4ã¤ä»¥ä¸Šã®è³ªå•ã§è©²å½“è¦ç´ ã‚’é¸æŠï¼‰ã®åˆ¤å®šåŸºæº–ã¯4ã§ç¶­æŒ
                const maxCity = totalScore.city >= 4;
                const maxNature = totalScore.nature >= 4;
                const maxHistory = totalScore.history >= 4;
                const lowBudget = totalScore.budget >= 4; // äºˆç®—é‡è¦–ã®å›ç­”ãŒå¢—ãˆãŸãŸã‚åˆ¤å®šã‚’ä¸Šã’ã‚‹
                const midToLongDuration = totalScore.duration >= 2;
                const nearEast = totalScore.near >= 4;
                const farWest = totalScore.far >= 3; // é æ–¹ã¸ã®å›ç­”ãŒå¢—ãˆãŸãŸã‚åˆ¤å®šã‚’ä¸Šã’ã‚‹

                // --- ã‚¢ã‚¸ã‚¢ãƒ»ã‚ªã‚»ã‚¢ãƒ‹ã‚¢ (è¿‘å ´ã€œä¸­è·é›¢ã€ç´„12ã‚«å›½) ---
                if (nearEast && maxCity) {
                    recommendations.push({ name: "éŸ“å›½ (ã‚½ã‚¦ãƒ«)", reason: "K-POPã¨ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã€éŸ“å›½ã‚³ã‚¹ãƒ¡ã‚„ç¾å‘³ã—ã„å±‹å°ã‚°ãƒ«ãƒ¡ãŒæ¥½ã—ã„ï¼" });
                    recommendations.push({ name: "å°æ¹¾ (å°åŒ—)", reason: "å¤œå¸‚ã‚°ãƒ«ãƒ¡ã¨å®‰å…¨ãªè¡—ã€ã‚¸ãƒ–ãƒªã®ã‚ˆã†ãªé¢¨æ™¯ã‚„ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå¯ºé™¢ã‚’è¦‹ã«è¡Œã“ã†ï¼" });
                }
                if (nearEast && totalScore.luxury >= 2) { // è´…æ²¢å‚¾å‘ã®å›ç­”ãŒå¢—åŠ 
                    recommendations.push({ name: "é¦™æ¸¯", reason: "å·¨å¤§ãªé«˜å±¤ãƒ“ãƒ«ç¾¤ã®å¤œæ™¯ã¨ã€ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ã€ãã—ã¦é£²èŒ¶ã‚°ãƒ«ãƒ¡ãŒé­…åŠ›ï¼" });
                    recommendations.push({ name: "ãƒã‚«ã‚ª", reason: "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã®ã‚ˆã†ãªæ­´å²çš„å»ºé€ ç‰©ã¨ã€è±ªè¯ãªãƒªã‚¾ãƒ¼ãƒˆä½“é¨“ãŒã§ãã‚‹å ´æ‰€ã§ã™ã€‚" });
                }
                if (lowBudget && midToLongDuration) {
                    recommendations.push({ name: "ã‚¿ã‚¤ (ãƒãƒ³ã‚³ã‚¯ã€ãƒ—ãƒ¼ã‚±ãƒƒãƒˆ)", reason: "ã‚¾ã‚¦ãªã©ã®å‹•ç‰©ã¨è§¦ã‚Œåˆãˆã‚‹ã‹ã‚‚ï¼ãã‚Œã„ãªãƒ“ãƒ¼ãƒã¨æ­´å²çš„ãªå¯ºé™¢ã‚‚è¦‹ã¦ã¿ã‚ˆã†ã€‚" });
                    recommendations.push({ name: "ãƒ™ãƒˆãƒŠãƒ  (ãƒãƒã‚¤ã€ãƒ›ãƒ¼ãƒãƒŸãƒ³)", reason: "ç‹¬ç‰¹ãªæ™¯è‰²ï¼ˆãƒãƒ­ãƒ³æ¹¾ãªã©ï¼‰ã‚„ã€ç¾å‘³ã—ã„ç±³ã®éººï¼ˆãƒ•ã‚©ãƒ¼ï¼‰ãªã©ã®é£Ÿæ–‡åŒ–ã‚’ä½“é¨“ã§ãã¾ã™ã€‚" });
                }
                if (totalScore.future >= 3 && totalScore.safety >= 3) {
                    // å®‰å…¨æ€§ã®è¡¨ç¾ã‚’èª¿æ•´
                    recommendations.push({ name: "ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«", reason: "æœªæ¥ã¿ãŸã„ãªå»ºç‰©ï¼ˆãƒãƒªãƒ¼ãƒŠãƒ™ã‚¤ã‚µãƒ³ã‚ºï¼‰ã‚„å¤§ããªå‹•ç‰©åœ’ã€å®‰å¿ƒã—ã¦éã”ã›ã‚‹ãã‚Œã„ãªéƒ½å¸‚ãŒé­…åŠ›ï¼" });
                }
                if (totalScore.nature >= 3 && totalScore.luxury >= 1) {
                    recommendations.push({ name: "ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢ (ãƒãƒªå³¶)", reason: "ç¥ã€…ã®å³¶ã¨å‘¼ã°ã‚Œã‚‹ç¾ã—ã„ãƒ“ãƒ¼ãƒã¨è‡ªç„¶ã€‚ãƒªã‚¾ãƒ¼ãƒˆã§ã‚†ã£ãŸã‚Šéã”ãã†ã€‚" });
                }
                 if (totalScore.animal >= 3 && maxNature) {
                    recommendations.push({ name: "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ (ã‚·ãƒ‰ãƒ‹ãƒ¼ã€ã‚´ãƒ¼ãƒ«ãƒ‰ã‚³ãƒ¼ã‚¹ãƒˆ)", reason: "ã‚³ã‚¢ãƒ©ã‚„ã‚«ãƒ³ã‚¬ãƒ«ãƒ¼ã€ã‚¦ã‚©ãƒ³ãƒãƒƒãƒˆãªã©ã€çã—ã„å‹•ç‰©ãŸã¡ã«ä¼šãˆã‚‹å›½ã§ã™ï¼" });
                    recommendations.push({ name: "ãƒ‹ãƒ¥ãƒ¼ã‚¸ãƒ¼ãƒ©ãƒ³ãƒ‰", reason: "æ˜ ç”»ã®èˆå°ã«ãªã£ãŸã‚ˆã†ãªã€ã¨ã¦ã‚‚ç¾ã—ã„å¤§è‡ªç„¶ã®ä¸­ã‚’æ¢æ¤œã—ã‚ˆã†ã€‚" });
                }
                if (totalScore.near >= 2 && totalScore.history >= 2) {
                     recommendations.push({ name: "ã‚«ãƒ³ãƒœã‚¸ã‚¢ (ã‚¢ãƒ³ã‚³ãƒ¼ãƒ«ãƒ¯ãƒƒãƒˆ)", reason: "å£®å¤§ãªå¤ä»£éºè·¡ã‚¢ãƒ³ã‚³ãƒ¼ãƒ«ãƒ¯ãƒƒãƒˆã‚’è¦‹ã¦ã€æ­´å²ã®å¤§ãã•ã‚’æ„Ÿã˜ã‚ˆã†ã€‚" });
                }
                 if (totalScore.near >= 2 && totalScore.city >= 1) {
                     recommendations.push({ name: "ãƒãƒ¬ãƒ¼ã‚·ã‚¢ (ã‚¯ã‚¢ãƒ©ãƒ«ãƒ³ãƒ—ãƒ¼ãƒ«)", reason: "å¤šæ–‡åŒ–ãŒæ··ã–ã£ãŸæ´»æ°—ã‚ã‚‹è¡—ã€‚ãƒšãƒˆãƒ­ãƒŠã‚¹ãƒ„ã‚¤ãƒ³ã‚¿ãƒ¯ãƒ¼ã¯å¿…è¦‹ï¼" });
                }

                // --- ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ (é è·é›¢ã€ç´„13ã‚«å›½) ---
                if (farWest && maxHistory && totalScore.luxury >= 2) {
                    recommendations.push({ name: "ã‚¤ã‚¿ãƒªã‚¢ (ãƒ­ãƒ¼ãƒã€ãƒ•ã‚£ãƒ¬ãƒ³ãƒ„ã‚§)", reason: "å¤ã„éºè·¡ã‚„çµµç”»ãŒãŸãã•ã‚“ï¼æœ¬å ´ã®ã‚¸ã‚§ãƒ©ãƒ¼ãƒˆã‚„ãƒ‘ã‚¹ã‚¿ã‚’é£Ÿã¹ã«è¡Œã“ã†ã€‚" });
                    recommendations.push({ name: "ãƒ•ãƒ©ãƒ³ã‚¹ (ãƒ‘ãƒª)", reason: "ã‚¨ãƒƒãƒ•ã‚§ãƒ«å¡”ã‚„è±ªè¯ãªå®®æ®¿ã€ãŠã„ã—ã„ãƒ‘ãƒ³ã‚„èŠ¸è¡“ä½œå“ãŒå¾…ã£ã¦ã„ã¾ã™ã€‚" });
                    recommendations.push({ name: "ã‚¤ã‚®ãƒªã‚¹ (ãƒ­ãƒ³ãƒ‰ãƒ³)", reason: "é­”æ³•ã®ç‰©èªã«å‡ºã¦ãã‚‹ã‚ˆã†ãªå ´æ‰€ã‚„ã€æ­´å²çš„ãªãŠåŸã€ã‹ã‚ã„ã„äºŒéšå»ºã¦ãƒã‚¹ãŒã‚ã‚Šã¾ã™ã€‚" });
                }
                if (totalScore.fantasy >= 3) {
                    recommendations.push({ name: "ãƒ‰ã‚¤ãƒ„", reason: "ãƒã‚¤ã‚·ãƒ¥ãƒ´ã‚¡ãƒ³ã‚·ãƒ¥ã‚¿ã‚¤ãƒ³åŸãªã©ã€ãŠã¨ãè©±ã«å‡ºã¦ãã‚‹ã‚ˆã†ãªãŠåŸãŒãŸãã•ã‚“ï¼" });
                    recommendations.push({ name: "ã‚ªãƒ¼ã‚¹ãƒˆãƒªã‚¢ (ã‚¦ã‚£ãƒ¼ãƒ³)", reason: "éŸ³æ¥½ã¨èŠ¸è¡“ã®éƒ½ã€‚ãã‚Œã„ãªå®®æ®¿ã‚„ã€é¦¬è»Šã«ä¹—ã£ã¦ç‹æ§˜æ°—åˆ†ã‚’å‘³ã‚ãŠã†ï¼" });
                }
                if (maxNature && totalScore.safety >= 3) {
                    recommendations.push({ name: "ã‚¹ã‚¤ã‚¹", reason: "ç¾ã—ã„ã‚¢ãƒ«ãƒ—ã‚¹ã®å±±ã€…ã€æ¹–ã€ãã—ã¦ç¾å‘³ã—ã„ãƒãƒ¼ã‚ºã¨ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆãŒæœ‰åã§ã™ã€‚" });
                    recommendations.push({ name: "åŒ—æ¬§ (ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³ã€ãƒãƒ«ã‚¦ã‚§ãƒ¼)", reason: "ãã‚Œã„ãªè‡ªç„¶ã¨ã€å¯’ã„å›½ãªã‚‰ã§ã¯ã®ã‚ªãƒ¼ãƒ­ãƒ©ã‚„åŒ—æ¬§ãƒ‡ã‚¶ã‚¤ãƒ³ã«è§¦ã‚Œã‚ˆã†ã€‚" });
                }
                if (maxHistory && totalScore.nature >= 2) {
                    recommendations.push({ name: "ã‚®ãƒªã‚·ãƒ£", reason: "é’ã¨ç™½ã®ãã‚Œã„ãªæµ·ã¨ã€æ˜”ã®ç¥æ§˜ãŸã¡ãŒä½œã£ãŸã‚ˆã†ãªç™½ã„å»ºç‰©ã‚’è¦‹ã«è¡Œã“ã†ã€‚" });
                    recommendations.push({ name: "ã‚¹ãƒšã‚¤ãƒ³", reason: "ã‚µã‚°ãƒ©ãƒ€ãƒ»ãƒ•ã‚¡ãƒŸãƒªã‚¢ãªã©ã€é¢ç™½ã„å½¢ã‚’ã—ãŸå»ºç‰©ã¨ã€æƒ…ç†±çš„ãªãƒ€ãƒ³ã‚¹ã‚’è¦‹ã«è¡Œã“ã†ï¼" });
                }
                if (farWest && maxCity) {
                    recommendations.push({ name: "ã‚ªãƒ©ãƒ³ãƒ€ (ã‚¢ãƒ ã‚¹ãƒ†ãƒ«ãƒ€ãƒ )", reason: "é¢¨è»Šã¨ãƒãƒ¥ãƒ¼ãƒªãƒƒãƒ—ã€é‹æ²³ãŒç¾ã—ã„å›½ã€‚è‡ªè»¢è»Šã§è¡—ã‚’å›ã‚‹ã®ãŒæ¥½ã—ã„ï¼" });
                    recommendations.push({ name: "ãƒ™ãƒ«ã‚®ãƒ¼", reason: "ä¸–ç•Œä¸€ç¾å‘³ã—ã„ãƒ¯ãƒƒãƒ•ãƒ«ã¨ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã€ãã—ã¦ã‹ã‚ã„ã„è¡—ä¸¦ã¿ãŒé­…åŠ›ï¼" });
                    recommendations.push({ name: "ãƒã‚§ã‚³ (ãƒ—ãƒ©ãƒ)", reason: "ä¸­ä¸–ã®ãŠåŸã‚„çŸ³ç•³ã®é“ãªã©ã€ãŠã¨ãè©±ã®ã‚ˆã†ãªæ™¯è‰²ãŒåºƒãŒã‚‹ç¾ã—ã„è¡—ã€‚" });
                }
                 if (maxHistory && lowBudget) {
                    recommendations.push({ name: "ãƒãƒ«ãƒˆã‚¬ãƒ«", reason: "ã‚«ãƒ©ãƒ•ãƒ«ãªè¡—ä¸¦ã¿ã¨ã€å¤§èˆªæµ·æ™‚ä»£ã®å¤ã„ãŠåŸã‚„æ¸¯ã‚’è¦‹ã«è¡Œã“ã†ã€‚" });
                }

                // --- åŒ—ç±³ãƒ»ä¸­å—ç±³ãƒ»ä¸­æ±ãƒ»ã‚¢ãƒ•ãƒªã‚« (è¶…é è·é›¢ãƒ»ç‰¹æ®Šã€ç´„10ã‚«å›½) ---
                if (farWest && (maxCity || maxNature)) {
                    recommendations.push({ name: "ã‚¢ãƒ¡ãƒªã‚« (è¥¿æµ·å²¸ï¼šLA, NY)", reason: "ä¸–ç•Œã§ä¸€ç•ªå¤§ããªãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ã‚„ã€æ˜ ç”»ã®ã‚»ãƒƒãƒˆã¿ãŸã„ãªè¡—ã€å¤§ããªè‡ªç„¶ã§éŠã¼ã†ï¼" });
                    recommendations.push({ name: "ã‚«ãƒŠãƒ€ (ãƒãƒ³ã‚¯ãƒ¼ãƒãƒ¼ã€ãƒ­ãƒƒã‚­ãƒ¼)", reason: "é›„å¤§ãªå±±ã‚„æ¹–ã€é‹ãŒè‰¯ã‘ã‚Œã°ã‚¯ãƒãªã©ã®å¤§ããªå‹•ç‰©ã«ã‚‚å‡ºä¼šãˆã‚‹ã‹ã‚‚ã€‚" });
                }
                if (totalScore.safety >= 3 && totalScore.nature >= 2 && totalScore.luxury >= 1) {
                    // å®‰å…¨æ€§ã®è¡¨ç¾ã‚’èª¿æ•´
                    recommendations.push({ name: "ãƒãƒ¯ã‚¤ (ã‚ªã‚¢ãƒ•å³¶)", reason: "ä¸€å¹´ä¸­ã‚ãŸãŸã‹ãã€å¿ƒé…ãªãæµ·ã§ã®éŠã³ã‚„ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ãŒæ¥½ã—ã‚ã¾ã™ã€‚" });
                }
                if (totalScore.future >= 3 && totalScore.luxury >= 3) {
                    recommendations.push({ name: "ã‚¢ãƒ©ãƒ–é¦–é•·å›½é€£é‚¦ (ãƒ‰ãƒã‚¤)", reason: "ä¸–ç•Œä¸€é«˜ã„ãƒ“ãƒ«ã‚„ã€å®¤å†…ã‚¹ã‚­ãƒ¼å ´ãªã©ã€ãŠé‡‘æŒã¡ã§æœªæ¥çš„ãªè¡—ã‚’ä½“é¨“ï¼" });
                    recommendations.push({ name: "ã‚«ã‚¿ãƒ¼ãƒ«", reason: "ç ‚æ¼ ã®ä¸­ã®æ–°ã—ã„æœªæ¥éƒ½å¸‚ï¼åšç‰©é¤¨ã‚„è¿‘æœªæ¥çš„ãªå»ºç‰©ã‚’è¦‹ã«è¡Œã“ã†ã€‚" });
                }
                if (totalScore.history >= 3 && totalScore.far >= 3) {
                    recommendations.push({ name: "ã‚¨ã‚¸ãƒ—ãƒˆ", reason: "å¤§ããªãƒ”ãƒ©ãƒŸãƒƒãƒ‰ã‚„ã€æ˜”ã®ç‹æ§˜ã®å®ç‰©ã‚’è¦‹ã«è¡Œã“ã†ã€‚ã¾ã‚‹ã§å†’é™ºå®¶ã«ãªã£ãŸæ°—åˆ†ï¼" });
                    recommendations.push({ name: "ãƒšãƒ«ãƒ¼ (ãƒãƒãƒ¥ãƒ”ãƒãƒ¥)", reason: "é›²ã®ä¸Šã®å¤ä»£éƒ½å¸‚ãƒãƒãƒ¥ãƒ”ãƒãƒ¥ï¼æ­´å²ã¨è‡ªç„¶ãŒä½œã‚Šå‡ºã—ãŸç¥ç§˜çš„ãªå ´æ‰€ã€‚" });
                }
                if (maxHistory && totalScore.nature >= 2 && totalScore.far >= 2) {
                    recommendations.push({ name: "ãƒ¡ã‚­ã‚·ã‚³ (ã‚«ãƒ³ã‚¯ãƒ³ã€ãƒ¡ã‚­ã‚·ã‚³ã‚·ãƒ†ã‚£)", reason: "ãƒãƒ¤æ–‡æ˜ã®ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ãªã©ã®å¤ä»£éºè·¡ã¨ã€ãã‚Œã„ãªãƒ“ãƒ¼ãƒã§éŠã¶ãƒªã‚¾ãƒ¼ãƒˆä½“é¨“ã€‚" });
                }
                if (totalScore.animal >= 2 && totalScore.far >= 3) {
                     recommendations.push({ name: "å—ã‚¢ãƒ•ãƒªã‚«", reason: "ã‚µãƒ•ã‚¡ãƒªã§ãƒ©ã‚¤ã‚ªãƒ³ã‚„ã‚­ãƒªãƒ³ãªã©ã®é‡ç”Ÿå‹•ç‰©ã‚’è¦‹ã«è¡Œã“ã†ï¼å¤§è¿«åŠ›ã®è‡ªç„¶ä½“é¨“ã§ã™ã€‚" });
                }
                if (totalScore.nature >= 3 && totalScore.far >= 3) {
                     recommendations.push({ name: "ãƒ–ãƒ©ã‚¸ãƒ«", reason: "ä¸–ç•Œä¸€å¤§ããªæ£®ï¼ˆã‚¢ãƒã‚¾ãƒ³ï¼‰ã‚„ã€å¤§ããªã‚­ãƒªã‚¹ãƒˆåƒã®ã‚ã‚‹ãƒªã‚ªãƒ‡ã‚¸ãƒ£ãƒã‚¤ãƒ­ã‚’æ¢æ¤œï¼" });
                }
                if (totalScore.animal >= 3 && totalScore.nature >= 3) {
                    recommendations.push({ name: "ã‚¬ãƒ©ãƒ‘ã‚´ã‚¹è«¸å³¶ï¼ˆã‚¨ã‚¯ã‚¢ãƒ‰ãƒ«ï¼‰", reason: "ãƒ€ãƒ¼ã‚¦ã‚£ãƒ³ãŒç ”ç©¶ã—ãŸçã—ã„å‹•ç‰©ãŒãŸãã•ã‚“ã„ã‚‹ã€è‡ªç„¶ã®å®å³¶ï¼" });
                }

                
                // --- çµæœã®æ•´ç†ã¨é¸å®š ---
                
                // 1. ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒªã‚¹ãƒˆã‚’ä½œæˆ (é‡è¤‡æ’é™¤)
                const uniqueRecommendations = [];
                const nameSet = new Set();

                for (const rec of recommendations) {
                    if (!nameSet.has(rec.name)) {
                        nameSet.add(rec.name);
                        uniqueRecommendations.push(rec);
                    }
                }
                
                // 2. æœ€çµ‚èª¿æ•´ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
                if (uniqueRecommendations.length === 0) {
                     // ã©ã®ã‚¹ã‚³ã‚¢ã«ã‚‚å¼·ãå½“ã¦ã¯ã¾ã‚‰ãªã‹ã£ãŸå ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’è¿”ã—ã¾ã™
                     return [
                        // å®‰å…¨æ€§ã®è¡¨ç¾ã‚’èª¿æ•´
                        { name: "ãƒãƒ¯ã‚¤ (ã‚ªã‚¢ãƒ•å³¶)", reason: "æµ·ãŒã¨ã£ã¦ã‚‚ãã‚Œã„ã§ã€å¿ƒé…ãªããƒãƒªãƒ³ã‚¹ãƒãƒ¼ãƒ„ã‚„ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ãŒæ¥½ã—ã‚ã¾ã™ã€‚" },
                        // å®‰å…¨æ€§ã®è¡¨ç¾ã‚’èª¿æ•´
                        { name: "ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«", reason: "ãƒãƒ¼ãƒ©ã‚¤ã‚ªãƒ³ã‚„æœªæ¥çš„ãªå»ºç‰©ãŒã‚ã‚Šã€å‹•ç‰©åœ’ã‚„ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¹ã‚¿ã‚¸ã‚ªãªã©ã®ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚‚å……å®Ÿï¼å®‰å¿ƒã—ã¦éŠã¹ã‚‹ãã‚Œã„ãªéƒ½å¸‚ã§ã™ã€‚" },
                        { name: "éŸ“å›½ (ã‚½ã‚¦ãƒ«)", reason: "çŸ­ã„ãŠä¼‘ã¿ã§ã€ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã¨éŸ“å›½ã‚°ãƒ«ãƒ¡ã‚’æ€ã„åˆ‡ã‚Šæ¥½ã—ã‚ã¾ã™ã€‚" },
                        { name: "ã‚¿ã‚¤ (ãƒãƒ³ã‚³ã‚¯)", reason: "å®‰ãã¦ç¾å‘³ã—ã„ã”é£¯ã¨ã€ãã‚Œã„ãªãƒ“ãƒ¼ãƒã‚„å¯ºé™¢ãªã©ã€è‰²ã€…ãªæ¥½ã—ã¿æ–¹ãŒã§ãã¾ã™ã€‚" }
                    ];
                }

                // 3. ã‚¹ã‚³ã‚¢åˆè¨ˆã‚’è¨ˆç®—ã—ã€åˆè¨ˆã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ (ã“ã“ã§é©åˆ‡ãªé‡ã¿ä»˜ã‘ã‚’è¡Œã†)
                uniqueRecommendations.forEach(rec => {
                    let scoreSum = 0;
                    // åœ°åŸŸã”ã¨ã«é‡ã¿ä»˜ã‘ãƒ­ã‚¸ãƒƒã‚¯ã‚’å†é©ç”¨
                    // ã‚¢ã‚¸ã‚¢ (è¿‘å ´, éƒ½å¸‚, äºˆç®—)
                    if (rec.name.includes("éŸ“å›½") || rec.name.includes("å°æ¹¾") || rec.name.includes("é¦™æ¸¯") || rec.name.includes("ãƒã‚«ã‚ª") || rec.name.includes("ãƒãƒ¬ãƒ¼ã‚·ã‚¢")) scoreSum = totalScore.near * 3 + totalScore.city * 2 + totalScore.budget * 2 + totalScore.luxury;
                    // æ±å—ã‚¢ã‚¸ã‚¢ (äºˆç®—, æœŸé–“, è‡ªç„¶, æ­´å²)
                    else if (rec.name.includes("ã‚¿ã‚¤") || rec.name.includes("ãƒ™ãƒˆãƒŠãƒ ") || rec.name.includes("ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢") || rec.name.includes("ã‚«ãƒ³ãƒœã‚¸ã‚¢")) scoreSum = totalScore.budget * 3 + totalScore.duration * 2 + totalScore.nature * 1.5 + totalScore.history * 2;
                    // ã‚ªã‚»ã‚¢ãƒ‹ã‚¢ (å‹•ç‰©, è‡ªç„¶, å®‰å…¨, é æ–¹)
                    else if (rec.name.includes("ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢") || rec.name.includes("ãƒ‹ãƒ¥ãƒ¼ã‚¸ãƒ¼ãƒ©ãƒ³ãƒ‰")) scoreSum = totalScore.animal * 3 + totalScore.nature * 2.5 + totalScore.safety * 2 + totalScore.far;
                    // åŒ—ç±³ãƒ»ãƒãƒ¯ã‚¤ (éƒ½å¸‚, è‡ªç„¶, è´…æ²¢, æœŸé–“)
                    else if (rec.name.includes("ã‚¢ãƒ¡ãƒªã‚«") || rec.name.includes("ã‚«ãƒŠãƒ€") || rec.name.includes("ãƒãƒ¯ã‚¤")) scoreSum = totalScore.city * 2 + totalScore.nature * 2 + totalScore.luxury * 2 + totalScore.duration * 1.5;
                    // ä¸­å—ç±³ (æ­´å², é æ–¹, å‹•ç‰©, è‡ªç„¶)
                    else if (rec.name.includes("ãƒ¡ã‚­ã‚·ã‚³") || rec.name.includes("ãƒ–ãƒ©ã‚¸ãƒ«") || rec.name.includes("ãƒšãƒ«ãƒ¼") || rec.name.includes("ã‚¬ãƒ©ãƒ‘ã‚´ã‚¹")) scoreSum = totalScore.history * 3 + totalScore.far * 3 + totalScore.animal * 2.5 + totalScore.nature * 2.5;
                    // ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ (é æ–¹, æ­´å², ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼, è´…æ²¢, è‡ªç„¶)
                    else if (rec.name.includes("ã‚¤ã‚¿ãƒªã‚¢") || rec.name.includes("ãƒ•ãƒ©ãƒ³ã‚¹") || rec.name.includes("ã‚¤ã‚®ãƒªã‚¹") || rec.name.includes("ãƒ‰ã‚¤ãƒ„") || rec.name.includes("ã‚¹ã‚¤ã‚¹") || rec.name.includes("ã‚ªãƒ¼ã‚¹ãƒˆãƒªã‚¢") || rec.name.includes("ã‚ªãƒ©ãƒ³ãƒ€") || rec.name.includes("ãƒ™ãƒ«ã‚®ãƒ¼") || rec.name.includes("ãƒã‚§ã‚³") || rec.name.includes("ã‚®ãƒªã‚·ãƒ£") || rec.name.includes("ã‚¹ãƒšã‚¤ãƒ³") || rec.name.includes("ãƒãƒ«ãƒˆã‚¬ãƒ«") || rec.name.includes("åŒ—æ¬§")) scoreSum = totalScore.far * 2.5 + totalScore.history * 3 + totalScore.fantasy * 2 + totalScore.luxury * 1.5 + totalScore.nature;
                    // ä¸­æ±ãƒ»ã‚¢ãƒ•ãƒªã‚« (æœªæ¥, è´…æ²¢, æ­´å², å‹•ç‰©, é æ–¹)
                    else if (rec.name.includes("ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«") || rec.name.includes("ãƒ‰ãƒã‚¤") || rec.name.includes("ã‚«ã‚¿ãƒ¼ãƒ«") || rec.name.includes("ã‚¨ã‚¸ãƒ—ãƒˆ") || rec.name.includes("å—ã‚¢ãƒ•ãƒªã‚«")) scoreSum = totalScore.future * 3 + totalScore.luxury * 2.5 + totalScore.history * 2.5 + totalScore.animal * 2.5 + totalScore.far * 2;
                    // å®‰å…¨ç­–
                    else scoreSum = totalScore.city + totalScore.nature + totalScore.history; 

                    rec.finalScore = scoreSum;
                });
                
                uniqueRecommendations.sort((a, b) => b.finalScore - a.finalScore);


                // æœ€çµ‚çš„ãªãƒªã‚¹ãƒˆã®æœ€åˆã®4ã¤ã‚’è¿”ã™ (ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºä¿ã®ãŸã‚)
                return uniqueRecommendations.slice(0, 4);
            },

            // --- çµæœè¡¨ç¤ºHTMLç”Ÿæˆ ---
            renderResult() {
                const results = this.calculateResult();

                let resultHtml = `
                    <div class="text-center py-6">
                        <h2 class="text-3xl font-bold text-blue-600 mb-4">ğŸ‰ è¨ºæ–­çµæœãŒå‡ºã¾ã—ãŸï¼ ğŸ‰</h2>
                        <p class="text-xl text-gray-700 mb-8">ã‚ãªãŸã«ãŠã™ã™ã‚ã®æµ·å¤–æ—…è¡Œå…ˆã¯ã“ã¡ã‚‰ã§ã™ã€‚</p>
                    </div>

                    <div class="space-y-4">
                        ${results.map((result, index) => {
                            let rankLabel = '';
                            let rankClass = 'border-gray-300 bg-white';
                            let titleClass = 'text-gray-800';

                            if (index === 0) {
                                rankLabel = 'ğŸ† ç¬¬1ä½';
                                rankClass = 'rank-1';
                                titleClass = 'text-amber-700';
                            } else if (index === 1) {
                                rankLabel = 'ğŸ¥ˆ ç¬¬2ä½';
                                rankClass = 'rank-2';
                                titleClass = 'text-gray-700';
                            } else if (index === 2) {
                                rankLabel = 'ğŸ¥‰ ç¬¬3ä½';
                                titleClass = 'text-gray-700';
                            } else {
                                rankLabel = 'âœ¨ ç¬¬4å€™è£œ';
                                titleClass = 'text-gray-700';
                            }

                            return `
                                <div class="p-4 border-2 ${rankClass} rounded-lg shadow-sm">
                                    <h3 class="text-xl font-extrabold ${titleClass} mb-1">
                                        ${rankLabel}: ${result.name}
                                    </h3>
                                    <p class="text-gray-600 text-sm">${result.reason}</p>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <div class="mt-10 text-center">
                        <p class="text-gray-500 mb-4">ã‚‚ã†ä¸€åº¦ã‚„ã‚Šç›´ã—ã¦ã€ä»–ã®å¯èƒ½æ€§ã‚’æ¢ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚</p>
                        <button onclick="app.resetQuiz()" class="px-6 py-3 bg-red-500 text-white font-semibold rounded-lg shadow-lg hover:bg-red-600 transition duration-150 ease-in-out">
                            æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™
                        </button>
                    </div>
                `;
                return resultHtml;
            },

            // --- ã‚¯ã‚¤ã‚ºãƒªã‚»ãƒƒãƒˆ ---
            resetQuiz() {
                this.currentStep = 0;
                this.answers = [];
                document.getElementById('navigation-buttons').style.display = 'flex';
                this.renderStep();
            }
        };

        // åˆæœŸåŒ–å®Ÿè¡Œ
        window.onload = () => {
            app.init();
        };
    </script>
</body>
</html>
